\part{Guide d'utilisation}
La présente section a pour but de décrire l'utilisation du \gls{sae}.

\section{\glsentryname{sae} - Description du service}
\label{sec:description_clearWay}

\gls{sae} est composé de trois éléments :
\begin{itemize}
    \item Le module caméra comprend une caméra (\gls{RPiCamera}), un socle en bois, un servomoteur (\gls{SG90})
          et un dispositif en plastique permettant de faire la liaison entre le servomoteur et la caméra.
    \item Un boîtier noir où se trouve une carte \gls{RPiCard}.
    \item Le panneau en bois intégrant des LEDs permettant les automobilistes qu'un cycliste arrive.
\end{itemize}

\section{Exécution de \glsentryname{sae}}
\label{sec:execution_clearWay}

\gls{sae} est actuellement un prototype.

\subsection{Utilisation du \glsentrytext{ssh}}
\label{sec:utilisationSSH}

Pour une exécution sur la \gls{raspberry} à distance, il faut établir une connexion \gls{ssh}
Pour se faire, le plus simple est d'être connecté au même réseau que cette dernière.

\subsubsection{Trouver l'adresse \glsentrytext{ip}}
\label{sec:trouverIP}

\paragraph{À partie du \textit{hostname}}

Si vous connaissez le \textit{hostname} de votre \gls{raspberry} : \mintinline{bash}{ping <hostname>.local}.\\
L'adresse \gls{ip} s'affichera dans le terminal.

\subparagraph{Exemple}

Pour une \gls{raspberry} dont le \textit{hostname} est \underline{raspberrypi} (valeur par défaut à
l'installation) :

\begin{minted}{bash}
            $ ping raspberrypi.local

            PING raspberrypi.local (123.123.123.123) 56(84) octets de données.
            64 octets de par10s33-in-f14.1e100.net (123.123.123.123) : icmp_seq=1 ttl=115 temps=19.3 ms
            64 octets de fra02s18-in-f14.1e100.net (123.123.123.123) : icmp_seq=2 ttl=115 temps=24.3 ms
            ...
\end{minted}

L'\gls{ip} nous est alors donné et est \texttt{123.123.123.123}.

\paragraph{À partie de votre adresse \glsentrytext{ip}}

Sinon retrouver votre adresse \gls{ip}\footnote{Référer vous à la documentation de votre OS}, afin de déterminer
la plage de sous-réseau, le et utiliser la commande \mintinline{bash}{nmap -sn <subnet>/24}.
L'ensemble des appareils sur votre réseau seront "pinger" :

\subparagraph{Exemple}

Si mon \gls{ip} est \texttt{123.123.123.5} alors mon sous-réseau est \texttt{123.123.123.0}.

\begin{minted}{text}
            # sudo nmap -sn 123.123.123.0/24

            Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-07 14:58 EAT
            Nmap scan report for 123.123.123.1
            Host is up (0.0055s latency).
            MAC Address: 50:0F:F5:3E:22:50 (Unknown)
            Nmap scan report for 123.123.123.106
            Host is up (0.010s latency).
            MAC Address: C4:D9:87:BA:88:17 (Intel Corporate)
            Nmap scan report for 123.123.123.105
            Host is up.
            MAC Address: B8:37:EB:EA: E0:D5 (Raspberry Pi Foundation)
            Nmap scan report for 123.123.123.200
            Host is up (0.0049s latency).
            Nmap done: 256 IP addresses (4 hosts up) scanned in 205.26 seconds.
\end{minted}

Dans notre exemple ci-dessus, la commande \texttt{nmap} a trouvé un périphérique \gls{raspberry} :

\begin{minted}{text}
    MAC Address: B8:37:EB:EA: E0:D5 (Raspberry Pi Foundation)
    Nmap scan report for 123.123.123.200
\end{minted}

\subsubsection{Connexion}

Pour se connecter en \gls{ssh} à la \gls{raspberry}, il faut connaitre l'utilisateur\footnote{Par défaut sur une
    \gls{raspberry}, l'utilisateur est \underline{pi}.} auquel on veut se connecter et l'\gls{ip} de la \gls{raspberry}
(voir section \nameref{sec:trouverIP}).\\
La commande à exécuter est :

\begin{minted}{bash}
    ssh <user>@<ip_address>
\end{minted}

Il vous sera alors demandé de confirmer si vous souhaiter vous connecter, et ensuite, le mot de passe de
l'utilisateur\footnote{Par défaut pour l'utilisateur \underline{pi}, le mot de passe est \underline{raspberry}}.

\paragraph{Copie de fichier de l'ordinateur vers la \glsentryname{raspberry}}
\label{sec:copieVersRaspberry}

Pour copier un fichier depuis votre ordinateur vers la \gls{raspberry} (ou une quelconque cible distante), il faut
utiliser la commande \texttt{scp} qui utilise le \gls{ssh}.\\
La commande est :

\begin{minted}{bash}
    scp <file_to_send> <user>@<ip_address>:<path_on_the_raspberry>
\end{minted}

\subsection{Arguments nécessaires pour l'exécution du programme}
\label{sec:executionArg_clearWay}
Certains arguments sont nécessaires afin d'utiliser \gls{sae}. La liste ci-dessous répertorie ces derniers.
Chaque argument doit être précédé par \verb=--=.
\begin{table}[H]
    \centering
    \rowcolors{2}{tableColor}{white}
    \begin{tabularx}{\linewidth}{|c|X|c|}
        % Header
        \hline
        \rowcolor{tableColorDark} Argument & Signification                                                                                                                                           & Support              \\
        \hline
        % Data
        \verb=yolo-weights YOLO_WEIGHTS=   & Requis si l'argument \verb=config= n'est pas renseigné. Chemin vers le fichier yolo-weights                                                             & Raspberry Ordinateur \\\hline
        \verb=yolo-cfg YOLO_CFG=           & Requis si l'argument \verb=config= n'est pas renseigné. Chemin vers le fichier yolo-cfg                                                                 & Raspberry Ordinateur \\\hline
        \verb=size SIZE=                   & Requis si l'argument \verb=config= n'est pas renseigné. La taille de l'image (320 ou 416 recommandés).                                                  & Raspberry Ordinateur \\\hline
        \verb=config CONFIG=               & (Utilisable avec l'alias \verb=-c CONFIG=) Chemin vers le fichier de configuration. À utiliser si les trois arguments précédents n'ont pas été précisés & Raspberry Ordinateur \\\hline
    \end{tabularx}
    \label{tab:ArgClearway}
    \caption{Argument d'exécution de \gls{sae}}
\end{table}

\subsection{Options possibles pour le programme}
\label{sec:executionOption_clearWay}
\gls{sae} est livré avec plusieurs options à renseigner lors du démarrage du programme. La liste ci-dessous répertorie ces dernières.
Chaque option doit être précédée par \verb=--=.
\begin{table}[H]
    \centering
    \rowcolors{2}{tableColor}{white}
    \begin{tabularx}{\linewidth}{|c|X|c|}
        % Header
        \hline
        \rowcolor{tableColorDark} Option      & Signification                                                                                                                                           & Support              \\
        \hline
        % Data
        \verb=camera_angle=                          & Renseigner l'angle de la caméra en degrés.                                                                                                                        & Raspberry               \\\hline
        \verb=help=                                  & (Utilisable avec l'alias \verb=-h=) Affiche les arguments et options possibles.                                                                                   & Raspberry Ordinateur    \\\hline
        \verb=input-path INPUT_PATH=                 & (Utilisable avec l'alias \verb=-i INPUT_PATH=) Chemin vers la vidéo à analyser si la caméra n'est pas utilisée                                                    & Raspberry Ordinateur    \\\hline
        \verb=no-gpio=                               & Les GPIOs ne seront pas utilisés. Uniquement les logs seront affichés.                                                                                            & Raspberry Ordinateur    \\\hline
        \verb=on-raspberry=                          & Informe le programme que le Raspberry sera utilisée                                                                                                               & Raspberry               \\\hline
        \verb=output-path OUTPUT_PATH=               & (Utilisable avec l'alias \verb=-o OUTPUT_PATH=) Chemin vers le dossier qui contraindra la vidéo analysée (inclut les boxes autours des objets détectés)           & Raspberry Ordinateur    \\\hline
        \verb=panel_gpios PANEL_GPIOS=               & Informe le programme quel(s) GPIO(s) utiliser, sous forme d'une liste                                                                                             & Raspberry               \\\hline
        \verb=see-rtp=                               & Permet d'avoir une fenêtre avec l'analyse en temps réelle.                                                                                                        & Raspberry Ordinateur    \\\hline
        \verb=servo_gpio=                            & Permet d'indiquer la broche GPIO utilisé par le servomoteur.                                                                                                      & Raspberry               \\\hline
        \verb=use-gpio=                              & Les GPIOs seront utilisés, les logs seront également affichés.                                                                                                    & Raspberry               \\\hline
        \verb=verbosity {WARNING,INFO,DEBUG}=        & (Utilisable avec l'alias \verb=-v {WARNING,INFO,DEBUG}=) Indique le niveau de verbosité.                                                                          & Raspberry Ordinateur    \\\hline
        \verb=version=                               & (Utilisable avec l'alias \verb=-V=) Affiche la version de \gls{sae}                                                                                               & Raspberry Ordinateur    \\\hline
    \end{tabularx}
    \label{tabOptClearway}
    \caption{Options d'exécution de \gls{sae}}
\end{table}

\subsection{Champs du fichier .toml}
\label{sec:executionTOML_clearWay}
\gls{sae} est livré avec un fichier toml permettant de configurer le système.
\begin{table}[H]
    \centering
    \rowcolors{2}{tableColor}{white}
    \begin{tabularx}{\linewidth}{|c|X|c|}
        % Header
        \hline
        \rowcolor{tableColorDark} Fichier toml & Signification & Support   \\
        \hline
        % Data
        \texttt{camera\_angle = 90}                  & Renseigner l'angle de la caméra en degrés                                                                                                                         & Raspberry               \\\hline
        \texttt{format = "Format\_Type"}             & Format du fichier de logging, \href{https://docs.python.org/3/howto/logging-cookbook.html\#formatting-styles}{documentation}                                      & Raspberry Ordinateur    \\\hline
        \texttt{on-raspberry = false}                & Informe le programme que le Raspberry sera utilisée                                                                                                               & Raspberry               \\\hline
        \texttt{path = "clearway.log"}               & Chemin où sera sauvegardé le fichier des logging                                                                                                                  & Raspberry               \\\hline
        \texttt{panel = [5, 7]}                      & Informe le programme quel(s) GPIO(s) utiliser, sous forme d'une liste                                                                                             & Raspberry               \\\hline
        \texttt{see-rtp = false}                     & Permet d'avoir une fenêtre avec l'analyse en temps réelle                                                                                                         & Raspberry Ordinateur    \\\hline
        \texttt{servo\_gpio = 17}                    & Permet d'indiquer la broche GPIO utilisé par le servomoteur                                                                                                       & Raspberry               \\\hline
        \texttt{size = 416}                          & La taille de l'image (320 ou 416 recommandés).                                                                                                                    & Raspberry Ordinateur    \\\hline
        \texttt{use-gpio = false}                    & Les GPIOs seront utilisés, les logs seront également affichés.                                                                                                    & Raspberry               \\\hline
        \texttt{verbosity = "DEBUG"}                 & Indique le niveau de verbosité                                                                                                                                    & Raspberry Ordinateur    \\\hline
        \texttt{yolo\_cfg = "yolov2.cfg"}            & Chemin jusqu'au fichier .cfg de yolo                                                                                                                              & Raspberry Ordinateur    \\\hline
        \texttt{yolo\_weight = "yolov2.weight"}      & Chemin jusqu'au fichier .weight de yolo                                                                                                                           & Raspberry Ordinateur    \\\hline
    \end{tabularx}
    \label{tab:tomlClearway}
    \caption{Argument d'exécution de \gls{sae}}
\end{table}
